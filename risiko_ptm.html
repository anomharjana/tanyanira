<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prediksi Risiko PTM</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      padding: 20px;
    }

    h1, h2 {
      color: #2c3e50;
    }

    form {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    input[type="range"] {
      width: 100%;
    }

    .range-labels {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      padding: 0 4px;
      margin-top: 2px;
      color: #555;
    }

    .button {
      background-color: #2269a3;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 20px;
    }

    .result {
      background: #e8f6f3;
      border: 1px solid #1abc9c;
      padding: 15px;
      margin-top: 20px;
      border-radius: 10px;
    }

    canvas {
      margin-top: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    table, th, td {
      border: 1px solid #1abc9c;
    }

    th, td {
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #d1f2eb;
    }

    /* Style untuk Tombol Kembali ke Home */
.home-button {
  background-color: #e0e0e0; /* Warna biru yang cerah */
  color: black;              /* Teks putih */
  padding: 12px 25px;        /* Padding kiri-kanan dan atas-bawah */
  font-size: 16px;           /* Ukuran font */
  border: none;              /* Menghilangkan border default */
  border-radius: 50px;       /* Sudut tombol yang melengkung */
  cursor: pointer;           /* Kursor berubah menjadi pointer */
  transition: all 0.3s ease; /* Animasi transisi halus */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Efek bayangan */
  margin: 20px 0;            /* Margin di atas dan bawah tombol */
  display: inline-block;     /* Menjaga tombol tetap dalam satu baris */
}

/* Efek Hover (ketika tombol disorot dengan kursor) */
.home-button:hover {
  background-color: #45a049; /* Warna biru gelap saat hover */
  transform: translateY(-2px); /* Mengangkat tombol sedikit */
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); /* Bayangan lebih gelap saat hover */
}

/* Efek Fokus (ketika tombol mendapat fokus) */
.home-button:focus {
  outline: none; /* Menghapus outline default */
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.5); /* Efek glow saat tombol mendapat fokus */
}

  </style>
</head>
<body>
  <h1>Prediksi Risiko Penyakit Tidak Menular (PTM)</h1>
  <form id="ptmForm">
    <h2>Status Kesehatan Saat Ini</h2>

    <label>Usia (tahun)</label>
    <input type="number" name="usia" required />

    <label>Berat Badan (kg)</label>
    <input type="number" name="bb" required />

    <label>Tinggi Badan (cm)</label>
    <input type="number" name="tb" required />

    <label>Riwayat Keluarga PTM</label>
    <select name="riwayat">
      <option value="1">Ya</option>
      <option value="0">Tidak</option>
    </select>

    <label>Merokok</label>
    <select name="rokok">
      <option value="1">Ya</option>
      <option value="0">Tidak</option>
    </select>

    <p><em>Berapa Hari dalam Seminggu (7 hari terakhir) Anda melakukan hal-hal berikut ini?</em></p>

    <label>Konsumsi Makanan Tinggi Gula</label>
    <input type="range" name="gula" min="1" max="7" class="range-labeled" />

    <label>Konsumsi Makanan Tinggi Garam</label>
    <input type="range" name="garam" min="1" max="7" class="range-labeled" />

    <label>Konsumsi Sayur & Buah</label>
    <input type="range" name="sayur" min="1" max="7" class="range-labeled" />

    <label>Aktivitas Fisik</label>
    <input type="range" name="aktivitas" min="1" max="7" class="range-labeled" />

    <label>Tidur Cukup</label>
    <input type="range" name="tidur" min="1" max="7" class="range-labeled" />

    <h2>Rencana Perubahan Perilaku</h2>
      <p><em>Untuk masa yang akan datang, berapa Hari dalam Seminggu (7 hari ke depan) Anda akan melakukan hal-hal berikut?</em></p>
    <label>Komitmen Olahraga</label>
    <input type="range" name="olahraga" min="1" max="7" class="range-labeled" />

    <label>Komitmen Makan Sehat</label>
    <input type="range" name="makan_sehat" min="1" max="7" class="range-labeled" />

    <label>Komitmen Hindari Merokok</label>
    <input type="range" name="hindari_rokok" min="1" max="7" class="range-labeled" />

    <label>Komitmen Tidur Teratur</label>
    <input type="range" name="tidur_teratur" min="1" max="7" class="range-labeled" />

    <button type="submit" class="button">Hitung Risiko</button>
  </form>

  <div id="output" class="result" style="display:none;"></div>
  <div id="bmiInfo" class="result" style="display:none;">
    <h4>Kategori BMI (Standar WHO)</h4>
    <table>
      <thead>
        <tr>
          <th>Kategori BMI</th>
          <th>Rentang BMI (kg/m<sup>2</sup>)</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>Berat badan kurang</td><td>&lt; 18.5</td></tr>
        <tr><td>Berat badan normal</td><td>18.5 - 24.9</td></tr>
        <tr><td>Berat badan berlebih</td><td>25.0 - 29.9</td></tr>
        <tr><td>Obesitas</td><td>&ge; 30.0</td></tr>
      </tbody>
    </table>
  </div>

  <canvas id="survivalChart" width="400" height="200" style="display:none;"></canvas>

  <script>
    function generateRangeLabels() {
      document.querySelectorAll('input[type="range"].range-labeled').forEach(input => {
        const min = parseInt(input.min);
        const max = parseInt(input.max);
        const labels = document.createElement('div');
        labels.className = 'range-labels';
        for (let i = min; i <= max; i++) {
          const span = document.createElement('span');
          span.textContent = i;
          labels.appendChild(span);
        }
        input.insertAdjacentElement('afterend', labels);
      });
    }

    function getBMICategory(bmi) {
      if (bmi < 18.5) return "Berat badan kurang";
      if (bmi < 25) return "Berat badan normal";
      if (bmi < 30) return "Berat badan berlebih";
      return "Obesitas";
    }

    window.addEventListener('DOMContentLoaded', generateRangeLabels);

    document.getElementById("ptmForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const form = e.target;
      const usia = parseInt(form.usia.value);
      const bb = parseFloat(form.bb.value);
      const tb = parseFloat(form.tb.value) / 100;
      if (tb <= 0) return alert("Tinggi badan tidak valid.");
      const bmi = bb / (tb * tb);
      const bmiCategory = getBMICategory(bmi);
      const ropt = val => parseInt(form[val].value);

      let risiko = 0;
      if (bmi > 30) risiko += 2;
      if (ropt("riwayat")) risiko += 2;
      if (ropt("gula") > 5) risiko += 1.5;
      if (ropt("garam") > 5) risiko += 1.2;
      if (ropt("sayur") < 3) risiko += 1;
      if (ropt("aktivitas") < 3) risiko += 1.5;
      if (ropt("rokok")) risiko += 2;
      if (ropt("tidur") < 3) risiko += 1;

      if (ropt("olahraga") >= 6) risiko -= 1;
      if (ropt("makan_sehat") >= 6) risiko -= 1;
      if (ropt("hindari_rokok") >= 6) risiko -= 1;
      if (ropt("tidur_teratur") >= 6) risiko -= 1;

      let kategori = "Rendah";
      if (risiko >= 6) kategori = "Tinggi";
      else if (risiko >= 3) kategori = "Sedang";

      let prediksi = [];
      if (risiko >= 6) {
        prediksi = [
          { nama: "Diabetes Mellitus Tipe 2", tahun: usia + 3 },
          { nama: "Hipertensi", tahun: usia + 5 },
          { nama: "Jantung Koroner", tahun: usia + 7 }
        ];
      } else if (risiko >= 3) {
        prediksi = [
          { nama: "Hipertensi", tahun: usia + 6 },
          { nama: "Stroke Ringan", tahun: usia + 10 }
        ];
      } else {
        prediksi = [{ nama: "Risiko minimal dalam 10 tahun ke depan", tahun: "-" }];
      }

      const prediksiText = prediksi.map(p =>
        `<li>${p.nama} ${p.tahun !== "-" ? `<strong>(sekitar usia ke-${p.tahun})</strong>` : ""}</li>`
      ).join("");

      document.getElementById("output").style.display = "block";
      document.getElementById("bmiInfo").style.display = "block";

      document.getElementById("output").innerHTML = `
        <h3>Hasil Prediksi Risiko PTM</h3>
        <p><strong>BMI Anda:</strong> ${bmi.toFixed(2)} (${bmiCategory})</p>
        <p><strong>Kategori Risiko:</strong> ${kategori}</p>
        <p><strong>Catatan:</strong> Risiko ini hanya prediksi berdasarkan data yang Anda masukkan.</p>
        <h4>Prediksi Penyakit Potensial:</h4>
        <ul>${prediksiText}</ul>
        <p><strong>Penjelasan Grafik:</strong> Grafik menunjukkan probabilitas Anda terkena PTM di masa depan berdasarkan data yang Anda masukkan. Semakin tinggi risiko Anda, semakin tinggi kemungkinan Anda terkena penyakit di usia tertentu.</p>
      `;

      if (window.survivalChartInstance) window.survivalChartInstance.destroy();
      const maxAge = 100;
      const lifeExpectancy = 74;
      const endAge = Math.min(maxAge, usia + lifeExpectancy);
      const years = Array.from({ length: endAge - usia + 1 }, (_, i) => usia + i);
      const ptmProbabilityRate = years.map((_, i) => {
        let decay = risiko * 0.02;
        let survival = 100 * Math.exp(-decay * i);
        return parseFloat((100 - survival).toFixed(2));
      });

      document.getElementById("survivalChart").style.display = "block";
      const ctx = document.getElementById("survivalChart").getContext("2d");

      const symbols = ['circle', 'triangle', 'rect', 'cross'];
      const colorPalette = ['#e74c3c', '#3498db', '#f1c40f', '#9b59b6'];
      const diseaseMarkers = prediksi.filter(p => p.tahun !== "-").map((p, idx) => {
        const tahunIndex = years.indexOf(p.tahun);
        return {
          label: p.nama,
          data: [{ x: p.tahun, y: ptmProbabilityRate[tahunIndex] }],
          pointStyle: symbols[idx % symbols.length],
          backgroundColor: colorPalette[idx % colorPalette.length],
          borderColor: colorPalette[idx % colorPalette.length],
          pointRadius: 8,
          pointHoverRadius: 10,
          showLine: false
        };
      });

      window.survivalChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: years,
          datasets: [
            {
              label: 'Probabilitas Terkena PTM (%)',
              data: ptmProbabilityRate,
              fill: false,
              borderColor: 'rgb(231, 76, 60)',
              tension: 0.1,
              pointRadius: 0
            },
            ...diseaseMarkers
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            title: {
              display: true,
              text: 'Grafik Probabilitas Terkena PTM di Masa Depan'
            },
            tooltip: {
              callbacks: {
                label: function (context) {
                  if (context.dataset.label && context.dataset.data.length === 1) {
                    return `${context.dataset.label}: ${context.parsed.y.toFixed(2)}% di usia ini`;
                  }
                  return `Risiko: ${context.parsed.y.toFixed(2)}%`;
                }
              }
            }
          },
          scales: {
            x: { title: { display: true, text: "Usia (tahun)" } },
            y: { title: { display: true, text: "Probabilitas (%)" }, min: 0, max: 100 }
          }
        }
      });

      // Hapus tombol sebelumnya jika sudah ada
const existingButton = document.getElementById('downloadPDF');
if (existingButton) existingButton.remove();

// Tambahkan Rekomendasi berdasarkan kategori risiko
let rekomendasi = "";

if (kategori === "Tinggi") {
  rekomendasi = `
    <p><strong>Rekomendasi Kesehatan:</strong></p>
    <ul>
      <li>Lakukan pemeriksaan kesehatan rutin (gula darah, tekanan darah, kolesterol).</li>
      <li>Perbaiki pola makan: kurangi konsumsi makanan tinggi gula, garam, dan lemak.</li>
      <li>Tingkatkan aktivitas fisik: minimal 30 menit sehari, 5 hari seminggu.</li>
      <li>Hindari rokok dan paparan asap rokok.</li>
      <li>Kelola stres dan pastikan tidur cukup (7–8 jam per hari).</li>
      <li>Konsultasikan dengan tenaga kesehatan untuk rencana pencegahan lebih lanjut.</li>
    </ul>
  `;
} else if (kategori === "Sedang") {
  rekomendasi = `
    <p><strong>Rekomendasi Kesehatan:</strong></p>
    <ul>
      <li>Mulai membiasakan pola makan sehat dan seimbang.</li>
      <li>Lakukan aktivitas fisik secara teratur minimal 150 menit/minggu.</li>
      <li>Hindari rokok dan mulai memperbaiki kualitas tidur.</li>
      <li>Lakukan skrining kesehatan berkala untuk deteksi dini risiko PTM.</li>
    </ul>
  `;
} else {
  rekomendasi = `
    <p><strong>Rekomendasi Kesehatan:</strong></p>
    <ul>
      <li>Teruskan gaya hidup sehat yang sudah dijalani.</li>
      <li>Pertahankan pola makan bergizi dan seimbang.</li>
      <li>Lanjutkan aktivitas fisik dan tidur cukup setiap hari.</li>
      <li>Lakukan pemeriksaan kesehatan secara berkala sebagai langkah preventif.</li>
    </ul>
  `;
}

// Sisipkan rekomendasi ke dalam output
document.getElementById("output").innerHTML += rekomendasi;


// Tambahkan tombol baru
const downloadPDFButton = document.createElement('button');
downloadPDFButton.textContent = 'Unduh PDF';
downloadPDFButton.classList.add('button');
downloadPDFButton.id = 'downloadPDF';
document.body.appendChild(downloadPDFButton);

downloadPDFButton.addEventListener('click', function () {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // Ambil tanggal dan jam sekarang
  const now = new Date();
  const tanggalCetak = now.toLocaleDateString('id-ID');
  const jamCetak = now.toLocaleTimeString('id-ID');

  // Tambahkan teks ke PDF
  doc.text('Prediksi Risiko Penyakit Tidak Menular (PTM)', 20, 20);
  doc.text(`Tanggal Cetak: ${tanggalCetak}`, 20, 30);
  doc.text(`Jam Cetak: ${jamCetak}`, 20, 38);
  doc.text(`BMI: ${bmi.toFixed(2)} (${bmiCategory})`, 20, 48);
  doc.text(`Kategori Risiko: ${kategori}`, 20, 56);
  doc.text('Prediksi Penyakit Potensial:', 20, 66);

  prediksi.forEach((p, index) => {
    doc.text(`${p.nama} - Usia: ${p.tahun !== "-" ? p.tahun : 'N/A'}`, 20, 76 + index * 10);
  });

  // Tambahkan grafik sebagai gambar
  const chartCanvas = document.getElementById('survivalChart');
  doc.addImage(chartCanvas, 'PNG', 20, 90 + prediksi.length * 10, 180, 100);

  // Simpan PDF
  doc.save('Prediksi_Risiko_PTM.pdf');
});
    });
  </script>

  <!-- Tombol Kembali ke Home -->
<button class="home-button" onclick="window.location.href='index.html';">Menu Utama</button>

</body>
</html>
